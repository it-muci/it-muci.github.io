<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤–æ˜Ÿäººç§‘æŠ€ï¼šå¼ºåŒ–ç³»ç»Ÿ</title>
    <style>
        /* CSS æ ·å¼å¼€å§‹ */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap');

        :root {
            --neon-blue: #00ffff;
            --neon-pink: #ff00ff;
            --dark-bg: #0a0a1a;
            --light-text: #e0e0e0;
            --glitch-color1: #ff00c1;
            --glitch-color2: #00ffc1;
            --success-green: #00ff66;
            --warning-orange: #ffaa00;
            --error-red: #ff3333;
            --console-bg: rgba(0, 50, 50, 0.3); /* æ·±é’è‰²åŠé€æ˜ */
            --console-border: var(--neon-blue);
            --console-text: var(--neon-blue);
            --console-input: #9affff;
        }

        /* ä¿®å¤æ•´ä¸ªé¡µé¢å¯æ»šåŠ¨çš„é—®é¢˜ */
        html, body {
            height: 100%; /* ç¡®ä¿htmlå’Œbodyéƒ½å æ»¡æ•´ä¸ªè§†å£é«˜åº¦ */
            margin: 0;
            padding: 0; /* ç§»é™¤é»˜è®¤çš„å†…è¾¹è· */
            overflow: hidden; /* é˜»æ­¢æ•´ä¸ªé¡µé¢çš„æ»šåŠ¨ï¼Œåœ¨åŠ è½½åŠ¨ç”»å®Œæˆåä¼šæ¢å¤ */
            overscroll-behavior: none; /* é˜²æ­¢åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå‡ºç°å¼¹æ€§æ»šåŠ¨æ•ˆæœ */
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: var(--dark-bg);
            color: var(--light-text);
            display: flex; /* å°†bodyè®¾ç½®ä¸ºflexå®¹å™¨ */
            flex-direction: column; /* å‚ç›´æ’åˆ—å­å…ƒç´  */
            justify-content: center; /* å‚ç›´å±…ä¸­ */
            align-items: center; /* æ°´å¹³å±…ä¸­ */
            position: relative;
            cursor: crosshair;
        }

        /* Linux å¼€æœºåŠ è½½åŠ¨ç”»æ ·å¼ */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000; /* é»‘è‰²èƒŒæ™¯ */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999; /* ç¡®ä¿å®ƒåœ¨æœ€é¡¶å±‚ */
            opacity: 1;
            transition: opacity 1s ease-out; /* éšè—æ—¶çš„æ¸å˜æ•ˆæœ */
        }

        #loading-screen.hidden {
            opacity: 0;
            pointer-events: none; /* éšè—åå…è®¸ç‚¹å‡»ä¸‹æ–¹å†…å®¹ */
        }

        .loading-console {
            width: 80%;
            max-width: 800px;
            height: 60%;
            max-height: 500px;
            background-color: rgba(0, 0, 0, 0.9);
            border: 2px solid #0f0; /* ç»¿è‰²è¾¹æ¡† */
            box-shadow: 0 0 15px #0f0, inset 0 0 7px #0f0;
            padding: 20px;
            font-family: 'Share Tech Mono', monospace;
            color: #0f0; /* ç»¿è‰²æ–‡æœ¬ */
            font-size: 1em;
            overflow: hidden; /* éšè—å†…å®¹æº¢å‡ºï¼Œæˆ‘ä»¬é€è¡Œè¾“å‡º */
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        #loading-output {
            flex-grow: 1;
            margin: 0;
            overflow-y: auto; /* å…è®¸æ–‡æœ¬å†…å®¹æ»šåŠ¨ */
            white-space: pre-wrap; /* ä¿ç•™ç©ºç™½ç¬¦å’Œæ¢è¡Œ */
            word-break: break-all; /* é˜²æ­¢é•¿å•è¯æº¢å‡º */
            line-height: 1.3;
        }

        #loading-output::-webkit-scrollbar {
            width: 8px;
        }
        #loading-output::-webkit-scrollbar-track {
            background: rgba(0, 255, 0, 0.1);
        }
        #loading-output::-webkit-scrollbar-thumb {
            background: #0f0;
            border-radius: 4px;
            box-shadow: 0 0 3px #0f0;
        }
        #loading-output::-webkit-scrollbar-thumb:hover {
            background: #0fff00;
            box-shadow: 0 0 7px #0fff00;
        }

        .loading-input-line {
            flex-shrink: 0; /* ä¸æ”¶ç¼© */
            margin-top: 10px;
        }

        .loading-prompt {
            color: #0fff00; /* æ›´äº®çš„ç»¿è‰² */
            margin-right: 5px;
        }

        .loading-cursor {
            animation: blink-cursor 1s step-end infinite;
        }

        @keyframes blink-cursor {
            from, to { opacity: 1; }
            50% { opacity: 0; }
        }

        /* éšè—ä¸»å†…å®¹ï¼Œç›´åˆ°åŠ è½½åŠ¨ç”»å®Œæˆ */
        #main-container {
            opacity: 0;
            transition: opacity 1s ease-in;
            /* ... ä¿æŒæ‚¨ç°æœ‰çš„å…¶ä»–æ ·å¼ ... */
        }
        #main-container.loaded {
            opacity: 1;
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        /* WebKit browsers (Chrome, Safari, Edge, Opera) */
        ::-webkit-scrollbar {
            width: 10px; /* æ»šåŠ¨æ¡æ•´ä½“å®½åº¦ */
            height: 10px; /* æ»šåŠ¨æ¡æ•´ä½“é«˜åº¦ (for horizontal scrollbar) */
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3); /* æ»šåŠ¨æ¡è½¨é“èƒŒæ™¯ */
            border-radius: 5px; /* è½¨é“åœ†è§’ */
        }

        ::-webkit-scrollbar-thumb {
            background: var(--neon-blue); /* æ»šåŠ¨æ¡æ»‘å—é¢œè‰² */
            border-radius: 5px; /* æ»‘å—åœ†è§’ */
            border: 1px solid rgba(0, 255, 255, 0.5); /* æ»‘å—è¾¹æ¡† */
            box-shadow: 0 0 5px var(--neon-blue); /* æ»‘å—å‘å…‰æ•ˆæœ */
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--neon-pink); /* é¼ æ ‡æ‚¬åœæ—¶æ»‘å—é¢œè‰² */
            box-shadow: 0 0 10px var(--neon-pink); /* é¼ æ ‡æ‚¬åœæ—¶æ»‘å—å‘å…‰æ•ˆæœ */
            border: 1px solid rgba(255, 0, 255, 0.7);
        }

        /* Firefox support (limited styling) */
        * {
            scrollbar-color: var(--neon-blue) rgba(0, 0, 0, 0.3); /* thumb track */
            scrollbar-width: thin; /* auto | thin | none */
        }


        /* å…¨å±æ˜Ÿç©ºèƒŒæ™¯ */
        #star-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2; /* ç¡®ä¿åœ¨å…¶ä»–èƒŒæ™¯å±‚ä¹‹ä¸‹ */
            opacity: 0.7;
        }

        /* æ‰«æçº¿æ•ˆæœ */
        #scan-lines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                transparent 0,
                rgba(0, 255, 255, 0.08) 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: -1; /* åœ¨æ˜Ÿç©ºä¹‹ä¸Šï¼Œå†…å®¹ä¹‹ä¸‹ */
        }

        /* å±å¹•å™ªå£°/æ•…éšœæ•ˆæœ */
        #screen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000; /* æœ€é¡¶å±‚ */
            opacity: 0; /* é»˜è®¤éšè— */
            transition: opacity 0.1s ease-out; /* å¿«é€Ÿè¿‡æ¸¡ */
        }

        #screen-overlay.glitch-noise {
            animation: screen-noise 0.2s infinite; /* å¿«é€Ÿå™ªå£° */
            opacity: 0.2;
        }

        @keyframes screen-noise {
            0% {
                background-position: 0 0;
                background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAAUVBMVEWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYUnN8m4AAAAHHRSTlMA+++++++++++++hL3+mAAAAAVRSTlMAAwYJCw0PEhcZGiMtLzE3OT0+REAARX+oAAAAJklEQVR4Xr3BgQ2AMBADwJgDwz/T0g/E8+5v5j3B+w+G2o22n5p92gAAAABJRU5ErkJggg==');
            }
            100% {
                background-position: 50px 50px;
                background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAAUVBMVEWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYUnN8m4AAAAHHRSTlMA+++++++++++++hL3+mAAAAAVRSTlMAAwYJCw0PEhcZGiMtLzE3OT0+REAARX+oAAAAJklEQVR4Xr3BgQ2AMBADwJgDwz/T0g/E8+5v5j3B+w+G2o22n5p92gAAAABJRU5RUjSUrkJggg==');
            }
        }


        /* é¼ æ ‡è¿½è¸ªå…‰ç‚¹ */
        .glow-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            background-color: var(--neon-blue);
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px var(--neon-blue),
                        0 0 20px var(--neon-blue),
                        0 0 30px var(--neon-blue),
                        0 0 40px var(--neon-blue);
            animation: pulse-glow 2s infinite alternate;
            z-index: 999;
        }

        @keyframes pulse-glow {
            from { opacity: 0.8; transform: scale(1) translate(-50%, -50%); }
            to { opacity: 0.6; transform: scale(1.2) translate(-50%, -50%); }
        }

        .container {
            background-color: rgba(0, 0, 0, 0.6);
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 20px var(--neon-blue), inset 0 0 10px var(--neon-blue);
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            position: relative;
            max-width: 900px;
            width: 90%;
            box-sizing: border-box;
            animation: border-flicker 3s infinite alternate; /* åˆå§‹é—ªçƒåŠ¨ç”» */

            /* æ ¸å¿ƒä¿®æ”¹ï¼šè®©å®¹å™¨é€‚åº”é«˜åº¦å¹¶å…è®¸å†…éƒ¨æ»šåŠ¨ */
            display: flex; /* å¯ç”¨Flexboxå¸ƒå±€ */
            flex-direction: column; /* å­å…ƒç´ å‚ç›´å †å  */
            flex-grow: 1; /* å…è®¸åœ¨bodyè¿™ä¸ªflexå®¹å™¨ä¸­å¡«å……å¯ç”¨ç©ºé—´ */
            min-height: 0; /* å…³é”®ï¼šé˜²æ­¢flex item (container) åœ¨å†…å®¹æº¢å‡ºæ—¶æ— é™åˆ¶å¢é•¿ */
            overflow-y: auto; /* å…è®¸ container è‡ªèº«å†…å®¹æº¢å‡ºæ—¶æ»šåŠ¨ */
            padding-bottom: 20px; /* é˜²æ­¢åº•éƒ¨å†…å®¹è¢«è£åˆ‡ï¼Œå› ä¸ºåº•éƒ¨æœ‰paddingå’Œmargin */
        }

        @keyframes border-flicker {
            0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
                border-color: var(--neon-blue);
                box-shadow: 0 0 20px var(--neon-blue), inset 0 0 10px var(--neon-blue);
            }
            20%, 24%, 55% {
                border-color: var(--neon-pink);
                box-shadow: 0 0 25px var(--neon-pink), inset 0 0 12px var(--neon-pink);
            }
        }

        /* åè®®æ¿€æ´»åçš„è¾¹æ¡†é¢œè‰² */
        .container.protocol-active {
            border-color: var(--success-green);
            box-shadow: 0 0 20px var(--success-green), inset 0 0 10px var(--success-green);
            animation: none; /* åœæ­¢åˆå§‹é—ªçƒ */
        }
        /* åè®®åœæ­¢åçš„è¾¹æ¡†é¢œè‰² (çŸ­æš‚æ˜¾ç¤ºï¼Œç„¶åæ¢å¤border-flicker) */
        .container.protocol-inactive-visual {
            border-color: var(--error-red);
            box-shadow: 0 0 20px var(--error-red), inset 0 0 10px var(--error-red);
            animation: none;
        }
        /* ç´§æ€¥å…³é—­çš„è¾¹æ¡†é¢œè‰² */
        .container.emergency-shutdown-visual {
            border-color: var(--error-red);
            box-shadow: 0 0 30px var(--error-red), inset 0 0 15px var(--error-red);
            animation: emergency-flicker 0.2s infinite; /* ç´§æ€¥é—ªçƒ */
        }

        @keyframes emergency-flicker {
            0%, 100% { border-color: var(--error-red); box-shadow: 0 0 30px var(--error-red), inset 0 0 15px var(--error-red); }
            50% { border-color: var(--neon-pink); box-shadow: 0 0 20px var(--neon-pink), inset 0 0 10px var(--neon-pink); }
        }


        .header {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5em;
            color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue);
            margin-bottom: 30px;
            animation: text-flicker 4s infinite alternate;
            position: relative;
            padding-bottom: 10px;
            /* ç¡®ä¿headerä¸ä¼šå æ®è¿‡å¤šç©ºé—´ */
            flex-shrink: 0; /* ä¸ä¼šæ”¶ç¼© */
        }

        .header::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: 0;
            transform: translateX(-50%);
            width: 80%;
            height: 2px;
            background: linear-gradient(to right, transparent, var(--neon-blue), transparent);
            box-shadow: 0 0 8px var(--neon-blue);
        }

        .section {
            margin-bottom: 30px;
            line-height: 1.8;
            font-size: 1.1em;
            position: relative;
            /* ç¡®ä¿sectionä¸ä¼šå æ®è¿‡å¤šç©ºé—´ */
            flex-shrink: 0; /* ä¸ä¼šæ”¶ç¼© */
        }

        .section.log-section { /* ä¸ºæ—¥å¿—åŒºåŸŸçš„çˆ¶çº§sectionæ·»åŠ ä¸€ä¸ªç±» */
            flex-grow: 1; /* å…è®¸æ—¥å¿—sectionåœ¨containerä¸­å¡«å……å‰©ä½™ç©ºé—´ */
            display: flex; /* å°†å…¶è®¾ç½®ä¸ºflexå®¹å™¨ */
            flex-direction: column; /* å­å…ƒç´ å‚ç›´å †å  */
            min-height: 0; /* å…³é”®ï¼šé˜²æ­¢flex item (section) æ— é™åˆ¶å¢é•¿ */
        }
        .section.console-section { /* ä¸ºæ§åˆ¶å°åŒºåŸŸçš„çˆ¶çº§sectionæ·»åŠ ä¸€ä¸ªç±» */
            flex-shrink: 0; /* æ§åˆ¶å°ä¸åº”éšç€å†…å®¹å˜å¤šè€Œä¼¸ç¼© */
        }


        .section h2 {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-pink);
            text-shadow: 0 0 8px var(--neon-pink);
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .data-display {
            background-color: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--neon-pink);
            box-shadow: 0 0 10px var(--neon-pink), inset 0 0 5px var(--neon-pink);
            padding: 20px;
            border-radius: 5px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            text-align: left;
            /* ç¡®ä¿data-displayä¸ä¼šå æ®è¿‡å¤šç©ºé—´ */
            flex-shrink: 0; /* ä¸ä¼šæ”¶ç¼© */
        }

        .data-item {
            padding: 10px;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.2);
        }

        .data-item:last-child {
            border-bottom: none;
        }

        .data-item strong {
            color: var(--neon-blue);
            display: block;
            margin-bottom: 5px;
        }

        /* ç³»ç»Ÿæ—¥å¿—åŒºåŸŸ */
        #system-log-area {
            background-color: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 10px var(--neon-blue), inset 0 0 5px var(--neon-blue);
            padding: 15px;
            border-radius: 5px;
            text-align: left;
            overflow-y: scroll; /* å…è®¸æ»šåŠ¨ */
            font-size: 0.9em;
            line-height: 1.4;
            color: var(--light-text);
            margin-bottom: 30px; /* ä¸ä¸‹æ–¹æŒ‰é’®ä¿æŒè·ç¦» */

            /* æ ¸å¿ƒä¿®æ”¹ï¼šè®©æ—¥å¿—åŒºåŸŸè‡ªåŠ¨å¡«å……å‰©ä½™é«˜åº¦ */
            flex-grow: 1; /* å…è®¸åœ¨çˆ¶çº§sectionä¸­å¡«å……å¯ç”¨ç©ºé—´ */
            min-height: 150px; /* æœ€å°é«˜åº¦ï¼Œç¡®ä¿åˆå§‹å¯è§æ€§ */
            max-height: 400px; /* æœ€å¤§é«˜åº¦ï¼Œé˜²æ­¢æ—¥å¿—åŒºåŸŸè¿‡å¤§æŒ¤å‹å…¶ä»–å†…å®¹ */

            /* ç‰¹å®šäºè¯¥åŒºåŸŸçš„æ»šåŠ¨æ¡æ ·å¼ï¼Œè¦†ç›–å…¨å±€ */
            &::-webkit-scrollbar {
                width: 8px; /* çª„ä¸€ç‚¹ */
            }
            &::-webkit-scrollbar-track {
                background: rgba(0, 0, 0, 0.2);
            }
            &::-webkit-scrollbar-thumb {
                background: var(--neon-blue);
                border-radius: 4px;
                border: 0px; /* æ— è¾¹æ¡† */
                box-shadow: 0 0 3px var(--neon-blue);
            }
            &::-webkit-scrollbar-thumb:hover {
                background: var(--neon-pink);
                box-shadow: 0 0 7px var(--neon-pink);
            }
        }

        .log-entry {
            margin-bottom: 5px;
        }
        .log-timestamp {
            color: rgba(255, 255, 255, 0.5);
            margin-right: 8px;
        }
        .log-level-info { color: var(--light-text); }
        .log-level-warn { color: var(--warning-orange); }
        .log-level-error { color: var(--error-red); }
        .log-level-success { color: var(--success-green); }
        .log-level-command { color: var(--console-input); } /* æ–°å¢å‘½ä»¤è¾“å…¥æ—¥å¿—é¢œè‰² */


        /* æŒ‰é’®é£æ ¼ - ä½¿ç”¨ CSS Grid */
        .controls {
            margin-top: 30px;
            display: grid; /* å¯ç”¨ Grid å¸ƒå±€ */
            /* è‡ªåŠ¨åˆ›å»ºåˆ—ï¼Œæ¯åˆ—æœ€å° 150pxï¼Œæœ€å¤§ 1fr (å¡«å……å‰©ä½™ç©ºé—´) */
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px; /* æŒ‰é’®ä¹‹é—´çš„é—´è·ï¼ŒåŒæ—¶æ§åˆ¶è¡Œå’Œåˆ— */
            flex-shrink: 0; /* ç¡®ä¿åœ¨containerä¸­ä¸ä¼šè¢«æŒ¤å‹ */
            justify-content: center; /* æŒ‰é’®åœ¨ grid å†…éƒ¨æ°´å¹³å±…ä¸­ (å½“åˆ—æ•°ä¸è¶³æ—¶) */
            align-items: flex-start; /* æŒ‰é’®åœ¨ grid å†…éƒ¨å‚ç›´é¡¶éƒ¨å¯¹é½ */
        }

        .control-button {
            background-color: transparent;
            border: 2px solid var(--neon-blue);
            color: var(--neon-blue);
            padding: 12px 25px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1em;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 5px var(--neon-blue);
            width: 100%; /* ç¡®ä¿æŒ‰é’®å¡«å……å…¶ç½‘æ ¼å•å…ƒæ ¼ */
            box-sizing: border-box; /* åŒ…å« padding å’Œ border åœ¨ width å†… */
            white-space: nowrap; /* é˜²æ­¢æŒ‰é’®æ–‡æœ¬æ¢è¡Œï¼Œé™¤éè®¾ç½® minmax ç¼©å° */
            overflow: hidden; /* éšè—è¶…å‡ºéƒ¨åˆ†ï¼Œå¦‚æœæ–‡æœ¬è¿‡é•¿ */
            text-overflow: ellipsis; /* æ–‡æœ¬è¶…å‡ºæ—¶æ˜¾ç¤ºçœç•¥å· */
        }

        .control-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background-color: var(--neon-blue);
            opacity: 0.2;
            transition: all 0.3s ease;
        }

        .control-button:hover::before {
            left: 0;
        }

        .control-button:hover:not(:disabled) {
            color: var(--dark-bg);
            background-color: var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue), 0 0 25px var(--neon-blue);
            text-shadow: none;
        }

        /* ç¦ç”¨æŒ‰é’®æ ·å¼ */
        .control-button:disabled {
            border-color: rgba(0, 255, 255, 0.3);
            color: rgba(0, 255, 255, 0.3);
            cursor: not-allowed;
            box-shadow: none;
        }
        .control-button:disabled::before {
            background-color: transparent;
        }

        /* åè®®æ¿€æ´»/åœæ­¢æŒ‰é’®ç‰¹å®šæ ·å¼ */
        #start-protocol-btn.active {
            border-color: var(--success-green);
            color: var(--success-green);
            box-shadow: 0 0 10px var(--success-green);
        }
        #stop-protocol-btn.active {
            border-color: var(--error-red);
            color: var(--error-red);
            box-shadow: 0 0 10px var(--error-red);
        }
        /* ç´§æ€¥å…³é—­æŒ‰é’®ç‰¹æ®Šæ ·å¼ */
        #emergency-shutdown-btn {
            border-color: var(--error-red);
            color: var(--error-red);
            box-shadow: 0 0 5px var(--error-red);
        }
        #emergency-shutdown-btn:hover:not(:disabled) {
            color: var(--dark-bg);
            background-color: var(--error-red);
            box-shadow: 0 0 15px var(--error-red), 0 0 25px var(--error-red);
        }

        /* æ•…éšœè‰ºæœ¯æ•ˆæœï¼ˆå¯é€‰ï¼‰ */
        .glitch {
            position: relative;
            animation: glitch-effect 5s infinite linear alternate;
        }

        @keyframes glitch-effect {
            0% { transform: translate(0); text-shadow: none; }
            2% { transform: translate(-2px, 2px); text-shadow: 2px -2px var(--glitch-color1), -2px 2px var(--glitch-color2); }
            4% { transform: translate(2px, -2px); text-shadow: -2px 2px var(--glitch-color1), 2px -2px var(--glitch-color2); }
            6% { transform: translate(0); text-shadow: none; }
            8% { transform: translate(-1px, 1px); text-shadow: 1px -1px var(--glitch-color1); }
            10% { transform: translate(1px, -1px); text-shadow: -1px 1px var(--glitch-color2); }
            12% { transform: translate(0); text-shadow: none; }
            100% { transform: translate(0); text-shadow: none; }
        }

        /* åè®®çŠ¶æ€å’Œè¿›åº¦æ¡ */
        #protocol-status-area {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px dashed rgba(255, 255, 255, 0.1);
            color: var(--light-text);
            font-size: 1.1em;
            flex-shrink: 0;
        }

        #protocol-status-message {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-blue);
            text-shadow: 0 0 8px var(--neon-blue);
            margin-bottom: 15px;
            min-height: 1.5em;
        }

        #protocol-progress-bar {
            width: 0%;
            height: 10px;
            background-color: var(--success-green);
            box-shadow: 0 0 10px var(--success-green);
            border-radius: 5px;
            transition: width 0.5s ease-out, opacity 0.5s ease-out;
            margin: 0 auto;
            max-width: 600px;
            opacity: 0;
        }
        #protocol-progress-bar.show {
            opacity: 1;
        }
        /* é”™è¯¯çŠ¶æ€çš„è¿›åº¦æ¡ */
        #protocol-progress-bar.error {
            background-color: var(--error-red);
            box-shadow: 0 0 10px var(--error-red);
        }

        /* æ¿€æ´»åçš„ç³»ç»ŸçŠ¶æ€æ˜¾ç¤º */
        #system-runtime-area {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px dashed rgba(255, 255, 255, 0.1);
            font-family: 'Orbitron', sans-serif;
            color: var(--success-green);
            text-shadow: 0 0 5px var(--success-green);
            font-size: 1.2em;
            text-align: left;
            flex-shrink: 0;
        }
        #system-runtime-area p {
            margin-bottom: 5px;
            text-shadow: none;
            color: var(--light-text);
            font-size: 0.9em;
        }
        #system-runtime-area span {
            display: block;
            margin-bottom: 10px;
            color: var(--neon-blue);
            text-shadow: 0 0 5px var(--neon-blue);
            font-size: 1.1em;
        }

        /* äº¤äº’å¼æ§åˆ¶å°æ ·å¼ */
        #console-output {
            background-color: var(--console-bg);
            border: 1px solid var(--console-border);
            box-shadow: 0 0 8px var(--console-border), inset 0 0 4px var(--console-border);
            padding: 15px;
            border-radius: 5px;
            text-align: left;
            overflow-y: scroll;
            font-size: 0.9em;
            line-height: 1.5;
            color: var(--console-text);
            height: 200px; /* å›ºå®šé«˜åº¦ */
            margin-bottom: 10px;
            white-space: pre-wrap; /* ä¿æŒæ¢è¡Œå’Œç©ºæ ¼ */
            font-family: 'Share Tech Mono', monospace;
        }

        #console-input-area {
            display: flex;
            align-items: center;
        }

        #console-input-prompt {
            color: var(--console-input);
            font-family: 'Share Tech Mono', monospace;
            margin-right: 5px;
            font-size: 1em;
        }

        #console-input {
            flex-grow: 1;
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--console-input);
            box-shadow: 0 0 5px var(--console-input);
            color: var(--console-input);
            font-family: 'Share Tech Mono', monospace;
            padding: 8px;
            border-radius: 3px;
            font-size: 1em;
            outline: none;
            transition: box-shadow 0.2s ease;
            /* æ–°å¢æˆ–ä¿®æ”¹ä»¥ä¸‹å±æ€§ */
            resize: none; /* ç¦ç”¨ç”¨æˆ·æ‰‹åŠ¨è°ƒæ•´å¤§å° */
            min-height: 38px; /* è®¾ç½®ä¸€ä¸ªæœ€å°é«˜åº¦ï¼Œå¤§çº¦ç­‰äºä¸€è¡Œinputçš„é«˜åº¦ */
            overflow-y: hidden; /* é»˜è®¤éšè—æ»šåŠ¨æ¡ï¼Œç”± JS æ§åˆ¶æ˜¾ç¤º */
            box-sizing: border-box; /* ç¡®ä¿paddingå’ŒborderåŒ…å«åœ¨å®½åº¦å†… */
            line-height: 1.5; /* ç¡®ä¿è¡Œé«˜ä¸è®¡ç®—é«˜åº¦ä¸€è‡´ */
            vertical-align: top; /* ç¡®ä¿æ–‡æœ¬åœ¨textareaé¡¶éƒ¨å¯¹é½ */
        }
        #console-input:focus {
            box-shadow: 0 0 10px var(--console-input), inset 0 0 5px var(--console-input);
        }

        /* èƒŒæ™¯éŸ³ä¹æŒ‰é’® */
        #music-toggle-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background-color: rgba(0, 0, 0, 0.6);
            border: 2px solid var(--neon-blue);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 0 10px var(--neon-blue);
            transition: all 0.3s ease;
            z-index: 998;
        }
        #music-toggle-btn .icon {
            font-size: 1.5em;
            color: var(--neon-blue);
            transition: color 0.3s ease;
        }
        #music-toggle-btn.active {
            border-color: var(--neon-pink);
            box-shadow: 0 0 15px var(--neon-pink);
        }
        #music-toggle-btn.active .icon {
            color: var(--neon-pink);
        }
        #music-toggle-btn:hover {
            transform: scale(1.1);
        }


        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                padding-bottom: 10px; /* å‡å°åº•éƒ¨å¡«å……ï¼Œä¸ºå†…å®¹è…¾å‡ºç©ºé—´ */
            }
            .header {
                font-size: 1.8em;
            }
            .section {
                font-size: 1em;
            }
            .section h2 {
                font-size: 1.2em;
            }
            /* å“åº”å¼è®¾è®¡ä¸­çš„æŒ‰é’®è°ƒæ•´ */
            .controls {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 10px;
            }
            .control-button {
                font-size: 0.9em; /* é€‚å½“å‡å°å­—ä½“å¤§å° */
                padding: 10px 15px; /* è°ƒæ•´å†…è¾¹è· */
            }
            .data-display {
                grid-template-columns: 1fr; /* å°å±å¹•æ•°æ®å•åˆ—æ˜¾ç¤º */
            }
            #console-output {
                height: 150px; /* è°ƒæ•´æ§åˆ¶å°é«˜åº¦ */
            }
            #music-toggle-btn {
                width: 40px;
                height: 40px;
                bottom: 10px;
                right: 10px;
            }
            #music-toggle-btn .icon {
                font-size: 1.2em;
            }
            .loading-console {
                width: 90%;
                height: 70%;
                padding: 15px;
            }
        }
        @media (max-width: 480px) {
            .controls {
                /* åœ¨æå°å±å¹•ä¸Šå¯èƒ½å¸Œæœ›æ¯è¡Œåªæœ‰ä¸€ä¸ªæŒ‰é’® */
                grid-template-columns: 1fr;
            }
        }
        /* CSS æ ·å¼ç»“æŸ */
    </style>
</head>
<body>
    <div id="loading-screen">
        <div class="loading-console">
            <pre id="loading-output"></pre>
            <div class="loading-input-line">
                <span class="loading-prompt">root@system:~#</span>
                <span class="loading-cursor">_</span>
            </div>
        </div>
    </div>

    <canvas id="star-canvas"></canvas>
    <div id="scan-lines"></div>
    <div id="screen-overlay"></div>
    <div class="glow-cursor"></div>

    <div class="container" id="main-container">
        <h1 class="header glitch" id="main-header">æ˜Ÿé™…åè®®æ•°æ®ä¸­å¿ƒ</h1>

        <div class="section">
            <h2><span class="glitch">è®¿é—®æ—¥å¿—</span></h2>
            <p id="decoded-text">æ•°æ®ä¼ è¾“ä¸­...</p>
        </div>

        <div class="section">
            <h2><span class="glitch">ç³»ç»ŸçŠ¶æ€</span></h2>
            <div class="data-display">
                <div class="data-item"><strong>æ ¸å¿ƒæ¸©åº¦:</strong> <span id="core-temp" class="data-value">25.7Â°C</span></div>
                <div class="data-item"><strong>èƒ½é‡è¾“å‡º:</strong> <span id="energy-output" class="data-value">98.2%</span></div>
                <div class="data-item"><strong>ç½‘ç»œå»¶è¿Ÿ:</strong> <span id="network-latency" class="data-value">3.2ms</span></div>
                <div class="data-item"><strong>CPUè´Ÿè½½:</strong> <span id="cpu-load" class="data-value">12%</span></div>
                <div class="data-item"><strong>å†…å­˜ä½¿ç”¨:</strong> <span id="memory-usage" class="data-value">4.5GB / 16GB</span></div>
                <div class="data-item"><strong>å­˜å‚¨ç©ºé—´:</strong> <span id="storage-space" class="data-value">85%</span></div>
                <div class="data-item"><strong>å¨èƒçŠ¶æ€:</strong> <span id="threat-status" class="data-value">æ— </span></div>
                <div class="data-item"><strong>ç³»ç»Ÿè¿è¡Œæ—¶é—´:</strong> <span id="system-uptime" class="data-value">0å¤©0æ—¶0åˆ†</span></div>
            </div>
        </div>

        <div class="section log-section">
            <h2><span class="glitch">ç³»ç»Ÿæ—¥å¿—</span></h2>
            <div id="system-log-area">
                </div>
        </div>

        <div class="section console-section">
            <h2><span class="glitch">äº¤äº’å¼æ§åˆ¶å°</span></h2>
            <div id="console-output">
                æ¬¢è¿æ¥åˆ°æ˜Ÿé™…åè®®æ§åˆ¶å°ã€‚è¾“å…¥'help'è·å–å‘½ä»¤åˆ—è¡¨ã€‚<br>
                ç­‰å¾…æŒ‡ä»¤...<br>
            </div>
            <div id="console-input-area">
                <span id="console-input-prompt">[PROT_SYS]$</span>
                <textarea id="console-input" rows="1" autofocus autocomplete="off"></textarea>
            </div>
        </div>

        <div class="controls">
            <button class="control-button" id="start-protocol-btn">å¯åŠ¨åè®®</button>
            <button class="control-button" id="stop-protocol-btn" disabled>åœæ­¢åè®®</button>
            <button class="control-button" id="sync-data-btn" disabled>æ•°æ®åŒæ­¥</button>
            <button class="control-button" id="upload-data-btn" disabled>ä¸Šä¼ æ•°æ®</button>
            <button class="control-button" id="reset-system-btn">é‡ç½®ç³»ç»Ÿ</button>
            <button class="control-button" id="emergency-shutdown-btn">ç´§æ€¥å…³é—­</button>
        </div>

        <div id="protocol-status-area">
            <p id="protocol-status-message"></p>
            <div id="protocol-progress-bar"></div>
        </div>

        <div id="system-runtime-area" style="display: none;">
            <p>åè®®è¿è¡Œæ—¶é—´:</p>
            <span id="protocol-runtime">00:00:00</span>
            <p>å½“å‰æ˜Ÿé™…æ ‡å‡†æ—¶:</p>
            <span id="galactic-time"></span>
        </div>
    </div>

    <div id="music-toggle-btn">
        <span class="icon">â™ª</span>
    </div>

    <audio id="click-sound" src="https://www.soundjay.com/buttons/beep-07a.mp3" preload="auto"></audio>
    <audio id="alarm-sound" src="https://www.soundjay.com/misc/alarms/alarm-sound-1.mp3" preload="auto"></audio>
    <audio id="background-music" src="https://www.soundjay.com/ambient/ambient-sound-5.mp3" loop preload="auto"></audio>
    <script>
        /* JavaScript é€»è¾‘å¼€å§‹ */
        // --- å…¨å±€å¼•ç”¨å’ŒçŠ¶æ€å˜é‡ ---
        const initialLogText = "åŠ å¯†æ•°æ®ä¼ è¾“æˆåŠŸã€‚æœªçŸ¥ä¿¡å·æºå·²è¯†åˆ«ã€‚åè®®ç‰ˆæœ¬ï¼šGamma-7ã€‚å»ºç«‹é€šä¿¡é“¾è·¯ä¸­...";
        const decodedTextElement = document.getElementById('decoded-text');
        let currentIndex = 0;
        let scrambleInterval;

        const glowCursor = document.querySelector('.glow-cursor');

        const starCanvas = document.getElementById('star-canvas');
        const starCtx = starCanvas.getContext('2d');
        let stars = [];
        const numStars = 500;

        // æ›´æ–°æ•°æ®é¡¹çš„å¼•ç”¨ï¼Œä»¥ä¾¿åŒ…å«æ–°æ·»åŠ çš„
        const dataElements = {
            coreTemp: document.getElementById('core-temp'),
            energyOutput: document.getElementById('energy-output'),
            networkLatency: document.getElementById('network-latency'),
            cpuLoad: document.getElementById('cpu-load'),
            memoryUsage: document.getElementById('memory-usage'),
            storageSpace: document.getElementById('storage-space'),
            threatStatus: document.getElementById('threat-status'),
            systemUptime: document.getElementById('system-uptime')
        };
        const originalDataValues = {
            coreTemp: '25.7Â°C',
            energyOutput: '98.2%',
            networkLatency: '3.2ms',
            cpuLoad: '12%',
            memoryUsage: '4.5GB / 16GB',
            storageSpace: '85%',
            threatStatus: 'æ— ',
            systemUptime: '0å¤©0æ—¶0åˆ†'
        };

        let dataUpdateInterval;
        let systemUptimeSeconds = 0;

        const startProtocolBtn = document.getElementById('start-protocol-btn');
        const stopProtocolBtn = document.getElementById('stop-protocol-btn');
        const syncDataBtn = document.getElementById('sync-data-btn');
        const uploadDataBtn = document.getElementById('upload-data-btn'); // æ–°å¢ä¸Šä¼ æ•°æ®æŒ‰é’®
        const resetSystemBtn = document.getElementById('reset-system-btn');
        const emergencyShutdownBtn = document.getElementById('emergency-shutdown-btn');

        const mainHeader = document.getElementById('main-header');
        const mainContainer = document.getElementById('main-container'); // å·²ç»åœ¨åŠ è½½åŠ¨ç”»éƒ¨åˆ†å¼•ç”¨
        const protocolStatusMessage = document.getElementById('protocol-status-message');
        const protocolProgressBar = document.getElementById('protocol-progress-bar');

        const systemRuntimeArea = document.getElementById('system-runtime-area');
        const protocolRuntimeDisplay = document.getElementById('protocol-runtime');
        const galacticTimeDisplay = document.getElementById('galactic-time');
        let protocolStartTime = null;
        let runtimeUpdateInterval;
        let isProtocolActive = false;
        let isSystemResetting = false;

        const systemLogArea = document.getElementById('system-log-area');
        const screenOverlay = document.getElementById('screen-overlay');

        const clickSound = document.getElementById('click-sound');
        const alarmSound = document.getElementById('alarm-sound');
        const backgroundMusic = document.getElementById('background-music'); // èƒŒæ™¯éŸ³ä¹
        const musicToggleButton = document.getElementById('music-toggle-btn');

        // æ§åˆ¶å°å…ƒç´ 
        const consoleOutput = document.getElementById('console-output');
        const consoleInput = document.getElementById('console-input'); // ç°åœ¨æ˜¯ textarea
        const consoleInputPrompt = document.getElementById('console-input-prompt');
        let consoleHistory = [];
        let consoleHistoryIndex = -1;

        // --- è¾…åŠ©å‡½æ•°ï¼šæ’­æ”¾éŸ³æ•ˆ ---
        function playSound(audioElement, volume = 0.5) {
            audioElement.currentTime = 0; // é‡ç½®åˆ°å¼€å¤´ï¼Œä»¥ä¾¿å¯ä»¥å¿«é€Ÿé‡å¤æ’­æ”¾
            audioElement.volume = volume;
            audioElement.play().catch(e => console.log("Audio play failed:", e)); // æ•è·æ’­æ”¾é”™è¯¯
        }

        // --- è¾…åŠ©å‡½æ•°ï¼šå†™å…¥ç³»ç»Ÿæ—¥å¿— ---
        function writeLog(message, level = 'info') {
            const now = new Date();
            const timestamp = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
            const logEntry = document.createElement('div');
            logEntry.classList.add('log-entry');
            logEntry.innerHTML = `<span class="log-timestamp">[${timestamp}]</span> <span class="log-level-${level}">${message}</span>`;
            systemLogArea.appendChild(logEntry);
            systemLogArea.scrollTop = systemLogArea.scrollHeight; // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
            console.log(`[SYS LOG - ${level.toUpperCase()}] ${message}`); // åŒæ—¶è¾“å‡ºåˆ°æµè§ˆå™¨æ§åˆ¶å°
        }

        // --- è¾…åŠ©å‡½æ•°ï¼šå†™å…¥æ§åˆ¶å°è¾“å‡º ---
        function writeConsole(message, type = 'output') { // type: 'output', 'error', 'success', 'command'
            const line = document.createElement('div');
            if (type === 'command') {
                line.innerHTML = `<span style="color: var(--console-input);">${consoleInputPrompt.textContent} ${message}</span>`;
            } else if (type === 'error') {
                line.innerHTML = `<span style="color: var(--error-red);">é”™è¯¯: ${message}</span>`;
            } else if (type === 'success') {
                line.innerHTML = `<span style="color: var(--success-green);">${message}</span>`;
            } else {
                line.textContent = message;
            }
            consoleOutput.appendChild(line);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        // --- è¾…åŠ©å‡½æ•°ï¼šæ ¹æ®å†…å®¹è°ƒæ•´ textarea é«˜åº¦ ---
        function autoResizeConsoleInput() {
            consoleInput.style.height = 'auto'; // é¦–å…ˆé‡ç½®é«˜åº¦ä»¥è·å–å‡†ç¡®çš„ scrollHeight
            const currentHeight = consoleInput.scrollHeight;
            // è®¾ç½®æœ€å¤§é«˜åº¦ï¼Œä¾‹å¦‚ 200px (å¤§çº¦5-6è¡Œ)
            const maxHeight = 200;

            if (currentHeight > maxHeight) {
                consoleInput.style.height = `${maxHeight}px`;
                consoleInput.style.overflowY = 'scroll'; // è¶…è¿‡æœ€å¤§é«˜åº¦æ—¶æ˜¾ç¤ºæ»šåŠ¨æ¡
            } else {
                consoleInput.style.height = `${currentHeight}px`;
                consoleInput.style.overflowY = 'hidden'; // æœªè¶…è¿‡æœ€å¤§é«˜åº¦æ—¶éšè—æ»šåŠ¨æ¡
            }
        }

        // --- 1. æ–‡æœ¬è§£ç æ•ˆæœ ---
        function startDecodingAnimation(textToDecode = initialLogText, callback = null) {
            writeLog(`Initiating text decode for: "${textToDecode.substring(0, Math.min(textToDecode.length, 30))}..."`, 'info');
            currentIndex = 0;
            clearInterval(scrambleInterval);
            let displayInterval;

            scrambleInterval = setInterval(() => {
                let scrambled = '';
                for (let i = 0; i < textToDecode.length; i++) {
                    if (i < currentIndex) {
                        scrambled += textToDecode[i];
                    } else {
                        scrambled += String.fromCharCode(33 + Math.floor(Math.random() * 94));
                    }
                }
                decodedTextElement.textContent = scrambled;
            }, 50);

            displayInterval = setInterval(() => {
                currentIndex++;
                if (currentIndex > textToDecode.length) {
                    clearInterval(displayInterval);
                    clearInterval(scrambleInterval);
                    decodedTextElement.textContent = textToDecode;
                    if (callback) callback();
                    writeLog('Text decode complete.', 'success');
                }
            }, 50);
        }

        // --- 2. é¼ æ ‡è¿½è¸ªå…‰æ ‡ ---
        document.addEventListener('mousemove', (e) => {
            glowCursor.style.left = `${e.clientX}px`;
            glowCursor.style.top = `${e.clientY}px`;
        });

        // --- 3. æ˜Ÿç©ºèƒŒæ™¯ & æ‰«æçº¿ ---
        function resizeStarCanvas() {
            starCanvas.width = window.innerWidth;
            starCanvas.height = window.innerHeight;
            stars = [];
            for (let i = 0; i < numStars; i++) {
                stars.push({
                    x: Math.random() * starCanvas.width,
                    y: Math.random() * starCanvas.height,
                    radius: Math.random() * 1.5 + 0.5,
                    alpha: Math.random() * 0.5 + 0.5,
                    speed: Math.random() * 0.1 + 0.05
                });
            }
        }

        function animateStars() {
            starCtx.clearRect(0, 0, starCanvas.width, starCanvas.height);
            stars.forEach(star => {
                starCtx.beginPath();
                starCtx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                starCtx.fillStyle = `rgba(255, 255, 255, ${star.alpha})`;
                starCtx.fill();

                star.alpha += star.speed * (star.alpha > 0.9 || star.alpha < 0.5 ? -1 : 1);
                if (star.alpha > 1) star.alpha = 1;
                if (star.alpha < 0) star.alpha = 0;
            });
            requestAnimationFrame(animateStars);
        }

        // --- 4. æ•°æ®æ›´æ–°æ¨¡æ‹Ÿ ---
        function startDataSimulation() {
            writeLog("Starting data simulation...", 'info');
            clearInterval(dataUpdateInterval);
            dataUpdateInterval = setInterval(() => {
                let coreTemp = (isProtocolActive ? 30 + Math.random() * 8 : 25 + Math.random() * 5).toFixed(1);
                let energyOutput = (isProtocolActive ? 99.0 + Math.random() * 1.0 : 95 + Math.random() * 5).toFixed(1);
                let networkLatency = (isProtocolActive ? 1 + Math.random() * 2 : 3 + Math.random() * 3).toFixed(1);
                let cpuLoad = (isProtocolActive ? 40 + Math.random() * 30 : 10 + Math.random() * 15).toFixed(0);
                let memoryUsageGB = (isProtocolActive ? 8 + Math.random() * 6 : 4 + Math.random() * 3).toFixed(1);
                let totalMemoryGB = 16;
                let storageUsed = (isProtocolActive ? 85 + Math.random() * 5 : 80 + Math.random() * 5).toFixed(0);
                let threatStatus = 'æ— ';

                let tempColor = 'var(--light-text)';
                if (parseFloat(coreTemp) > 35) tempColor = 'var(--warning-orange)';
                if (parseFloat(coreTemp) > 38 && isProtocolActive) writeLog(`WARN: Core temp elevated to ${coreTemp}Â°C!`, 'warn');

                let energyColor = 'var(--light-text)';
                if (parseFloat(energyOutput) < 97) energyColor = 'var(--warning-orange)';

                let latencyColor = 'var(--light-text)';
                if (parseFloat(networkLatency) > 3) latencyColor = 'var(--warning-orange)';

                let cpuColor = 'var(--light-text)';
                if (parseFloat(cpuLoad) > 70) cpuColor = 'var(--error-red)';
                else if (parseFloat(cpuLoad) > 50) cpuColor = 'var(--warning-orange)';

                let storageColor = 'var(--light-text)';
                if (parseFloat(storageUsed) > 90) storageColor = 'var(--warning-orange)';

                let threatColor = 'var(--light-text)';
                const warningChance = isProtocolActive ? 0.03 : 0.01;
                if (Math.random() < warningChance) {
                    threatStatus = 'âš ï¸æ£€æµ‹åˆ°å¼‚å¸¸ä¿¡å·';
                    threatColor = 'var(--neon-pink)';
                    writeLog('CRITICAL: System integrity warning detected! Threat level elevated!', 'error');
                } else if (Math.random() < 0.01) { // å¶å°”å‡ºç°æ›´ä¸¥é‡è­¦å‘Š
                    threatStatus = 'ğŸš¨æœªçŸ¥å…¥ä¾µå°è¯•';
                    threatColor = 'var(--error-red)';
                    writeLog('ALERT: Unknown intrusion attempt detected. Countermeasures activated.', 'error');
                }


                dataElements.coreTemp.textContent = `${coreTemp}Â°C`;
                dataElements.coreTemp.style.color = tempColor;

                dataElements.energyOutput.textContent = `${energyOutput}%`;
                dataElements.energyOutput.style.color = energyColor;

                dataElements.networkLatency.textContent = `${networkLatency}ms`;
                dataElements.networkLatency.style.color = latencyColor;

                dataElements.cpuLoad.textContent = `${cpuLoad}%`;
                dataElements.cpuLoad.style.color = cpuColor;

                dataElements.memoryUsage.textContent = `${memoryUsageGB}GB / ${totalMemoryGB}GB`;
                dataElements.memoryUsage.style.color = 'var(--light-text)';

                dataElements.storageSpace.textContent = `${storageUsed}%`;
                dataElements.storageSpace.style.color = storageColor;

                dataElements.threatStatus.textContent = threatStatus;
                dataElements.threatStatus.style.color = threatColor;

                // æ›´æ–°ç³»ç»Ÿè¿è¡Œæ—¶é—´
                systemUptimeSeconds++;
                const days = Math.floor(systemUptimeSeconds / (3600 * 24));
                const hours = Math.floor((systemUptimeSeconds % (3600 * 24)) / 3600);
                const minutes = Math.floor((systemUptimeSeconds % 3600) / 60);
                dataElements.systemUptime.textContent = `${days}å¤©${hours}æ—¶${minutes}åˆ†`;


            }, 1000);
        }

        function stopDataSimulation() {
            writeLog("Stopping data simulation...", 'info');
            clearInterval(dataUpdateInterval);
            for (const key in dataElements) {
                dataElements[key].textContent = originalDataValues[key];
                dataElements[key].style.color = 'var(--light-text)';
            }
            systemUptimeSeconds = 0; // é‡ç½®è¿è¡Œæ—¶é—´
        }


        // --- 5. åè®®å¯åŠ¨é€»è¾‘ (å¢å¼ºç‰ˆ) ---
        startProtocolBtn.addEventListener('click', () => {
            playSound(clickSound);
            if (isProtocolActive || startProtocolBtn.disabled) return;

            writeLog("Attempting to start protocol...", 'info');
            // ç¦ç”¨æ‰€æœ‰æŒ‰é’®
            const allButtons = document.querySelectorAll('.control-button');
            allButtons.forEach(btn => btn.disabled = true);

            startProtocolBtn.textContent = 'åè®®å¯åŠ¨ä¸­...';
            startProtocolBtn.style.boxShadow = 'none';

            mainHeader.classList.add('glitch-active');
            setTimeout(() => {
                mainHeader.classList.remove('glitch-active');
            }, 500);

            protocolStatusMessage.textContent = 'åˆå§‹åŒ–ç³»ç»Ÿæ¨¡å—...';
            protocolStatusMessage.style.color = 'var(--neon-blue)';
            protocolProgressBar.style.width = '0%';
            protocolProgressBar.classList.remove('error');
            protocolProgressBar.classList.add('show');
            protocolProgressBar.style.boxShadow = '0 0 5px var(--neon-blue)';

            let progress = 0;
            const launchPhases = [
                { message: 'åˆå§‹åŒ–ç³»ç»Ÿæ¨¡å—...', duration: 500, log: 'Initializing core modules...' },
                { message: 'åŠ è½½å­ç¨‹åº...', duration: 700, log: 'Loading auxiliary subroutines...' },
                { message: 'å»ºç«‹é‡å­é“¾è·¯...', duration: 1000, log: 'Establishing quantum entanglement link...' },
                { message: 'æ¿€æ´»æ ¸å¿ƒåŠŸèƒ½...', duration: 800, log: 'Activating primary protocols...' },
                { message: 'æ ¡éªŒç³»ç»Ÿå®Œæ•´æ€§...', duration: 700, log: 'Verifying system integrity...' },
                { message: 'å‡†å¤‡æ•°æ®ä¼ è¾“...', duration: 500, log: 'Preparing for data transmission...' }
            ];
            let currentPhaseIndex = 0;
            let totalDuration = launchPhases.reduce((sum, phase) => sum + phase.duration, 0);
            let elapsedDuration = 0;

            const launchStep = () => {
                if (currentPhaseIndex < launchPhases.length) {
                    const phase = launchPhases[currentPhaseIndex];
                    protocolStatusMessage.textContent = phase.message;
                    writeLog(phase.log, 'info');

                    const interval = setInterval(() => {
                        elapsedDuration += 50;
                        progress = (elapsedDuration / totalDuration) * 100;
                        if (progress > 100) progress = 100;
                        protocolProgressBar.style.width = `${progress}%`;
                        protocolProgressBar.style.boxShadow = `0 0 ${5 + (progress / 10)}px var(--neon-blue)`; // è¿›åº¦æ¡å‘å…‰
                        if (elapsedDuration >= totalDuration) {
                            clearInterval(interval);
                        }
                    }, 50);

                    setTimeout(() => {
                        clearInterval(interval); // ç¡®ä¿å½“å‰é˜¶æ®µçš„intervalè¢«æ¸…é™¤
                        currentPhaseIndex++;
                        launchStep();
                    }, phase.duration);
                } else {
                    // All phases complete
                    isProtocolActive = true;
                    protocolStatusMessage.textContent = 'åè®®å·²æ¿€æ´»ã€‚ç³»ç»Ÿç¨³å®šã€‚';
                    protocolStatusMessage.style.color = 'var(--success-green)';
                    protocolProgressBar.style.width = '100%';
                    protocolProgressBar.style.boxShadow = '0 0 15px var(--success-green)';

                    startProtocolBtn.textContent = 'åè®®å·²æ¿€æ´»';
                    startProtocolBtn.classList.add('active');
                    stopProtocolBtn.disabled = false;
                    syncDataBtn.disabled = false;
                    uploadDataBtn.disabled = false; // å¯ç”¨ä¸Šä¼ æ•°æ®æŒ‰é’®
                    resetSystemBtn.disabled = false;
                    emergencyShutdownBtn.disabled = false;

                    mainContainer.classList.remove('protocol-inactive-visual', 'emergency-shutdown-visual');
                    mainContainer.classList.add('protocol-active');
                    mainContainer.style.animation = 'none';

                    startDecodingAnimation("åè®®æ¿€æ´»å®Œæ¯•ã€‚é“¾è·¯å·²å»ºç«‹ã€‚ç­‰å¾…ä¸‹ä¸€æŒ‡ä»¤ã€‚", () => {
                         protocolStartTime = Date.now();
                         systemRuntimeArea.style.display = 'block';
                         updateProtocolRuntime();
                         runtimeUpdateInterval = setInterval(updateProtocolRuntime, 1000);
                         writeLog("Protocol activated successfully. System online.", 'success');
                         writeConsole("ç³»ç»Ÿå·²æ¿€æ´»ã€‚åè®®ç‰ˆæœ¬ï¼šGamma-7ã€‚");
                    });
                    startDataSimulation();
                }
            };
            launchStep(); // Start the first phase
        });

        // --- 6. åè®®åœæ­¢é€»è¾‘ ---
        stopProtocolBtn.addEventListener('click', () => {
            playSound(clickSound);
            if (!isProtocolActive || stopProtocolBtn.disabled) return;

            writeLog("Attempting to stop protocol...", 'warn');
            // ç¦ç”¨æ‰€æœ‰æŒ‰é’®
            const allButtons = document.querySelectorAll('.control-button');
            allButtons.forEach(btn => btn.disabled = true);

            stopProtocolBtn.textContent = 'åè®®åœæ­¢ä¸­...';
            stopProtocolBtn.style.boxShadow = 'none';

            clearInterval(runtimeUpdateInterval);
            protocolRuntimeDisplay.textContent = '---';
            galacticTimeDisplay.textContent = '---';

            protocolStatusMessage.textContent = 'æ­£åœ¨å…³é—­æ ¸å¿ƒæ¨¡å—...';
            protocolStatusMessage.style.color = 'var(--error-red)';
            protocolProgressBar.style.width = '0%';
            protocolProgressBar.classList.add('show', 'error');
            protocolProgressBar.style.boxShadow = '0 0 5px var(--error-red)';


            let progress = 0;
            const stopInterval = setInterval(() => {
                progress += 10;
                protocolProgressBar.style.width = `${progress}%`;
                protocolProgressBar.style.boxShadow = `0 0 ${5 + (progress / 10)}px var(--error-red)`;

                if (progress <= 30) {
                    protocolStatusMessage.textContent = 'æ­£åœ¨å…³é—­æ ¸å¿ƒæ¨¡å—...';
                } else if (progress <= 60) {
                    protocolStatusMessage.textContent = 'è§£é™¤é“¾è·¯è¿æ¥...';
                } else if (progress < 100) {
                    protocolStatusMessage.textContent = 'ç³»ç»Ÿè„±ç¦»å¾…å‘½çŠ¶æ€...';
                } else {
                    clearInterval(stopInterval);
                    isProtocolActive = false;
                    protocolStartTime = null;
                    protocolStatusMessage.textContent = 'åè®®å·²åœæ­¢ã€‚ç³»ç»Ÿä¼‘çœ ã€‚';
                    protocolStatusMessage.style.color = 'var(--error-red)';
                    protocolProgressBar.style.width = '100%';
                    protocolProgressBar.style.boxShadow = '0 0 15px var(--error-red)';

                    startProtocolBtn.textContent = 'å¯åŠ¨åè®®';
                    startProtocolBtn.classList.remove('active');
                    startProtocolBtn.disabled = false;
                    stopProtocolBtn.textContent = 'åè®®å·²åœæ­¢';
                    stopProtocolBtn.classList.add('active'); // æš‚æ—¶ä¿æŒçº¢è‰²ï¼Œç„¶åé‡ç½®
                    stopProtocolBtn.disabled = true;
                    syncDataBtn.disabled = true;
                    uploadDataBtn.disabled = true; // åœæ­¢åä¸Šä¼ æ•°æ®æŒ‰é’®ç¦ç”¨
                    resetSystemBtn.disabled = false; // åœæ­¢åé‡ç½®æŒ‰é’®å¯ç”¨
                    emergencyShutdownBtn.disabled = false; // ç´§æ€¥å…³é—­æŒ‰é’®å¯ç”¨

                    mainContainer.classList.remove('protocol-active', 'emergency-shutdown-visual');
                    mainContainer.classList.add('protocol-inactive-visual');
                    mainContainer.style.animation = 'none';

                    systemRuntimeArea.style.display = 'none';

                    startDecodingAnimation("åè®®å·²å®‰å…¨ç»ˆæ­¢ã€‚ç³»ç»Ÿè¿›å…¥ä½åŠŸè€—æ¨¡å¼ã€‚", () => {
                        writeLog("Protocol stopped successfully. System is now in low power mode.", 'success');
                        writeConsole("ç³»ç»Ÿå·²åœæ­¢ã€‚è¿›å…¥ä½åŠŸè€—æ¨¡å¼ã€‚");
                    });
                    stopDataSimulation();

                    setTimeout(() => {
                        protocolProgressBar.style.width = '0%';
                        protocolProgressBar.classList.remove('show', 'error');
                        protocolProgressBar.style.boxShadow = 'none';
                        protocolStatusMessage.textContent = '';

                        mainContainer.classList.remove('protocol-inactive-visual');
                        mainContainer.style.animation = 'border-flicker 3s infinite alternate';
                        stopProtocolBtn.classList.remove('active');
                    }, 1500);
                }
            }, 300);
        });

        // --- 7. æ•°æ®åŒæ­¥é€»è¾‘ ---
        syncDataBtn.addEventListener('click', () => {
            playSound(clickSound);
            if (syncDataBtn.disabled) return;

            writeLog("Initiating data synchronization...", 'info');
            syncDataBtn.disabled = true;
            syncDataBtn.textContent = 'åŒæ­¥ä¸­...';
            syncDataBtn.style.boxShadow = '0 0 10px var(--warning-orange)';

            startDecodingAnimation("æ­£åœ¨è¯·æ±‚è¿œç¨‹æ•°æ®æµã€‚æ ¡éªŒæ ¡éªŒå’Œ... æ•°æ®åŒ…æ¥æ”¶ä¸­...", () => {
                protocolStatusMessage.textContent = 'æ•°æ®åŒæ­¥å®Œæˆã€‚ç¼“å­˜å·²æ›´æ–°ã€‚';
                protocolStatusMessage.style.color = 'var(--success-green)';
                protocolProgressBar.style.width = '100%';
                protocolProgressBar.classList.remove('error');
                protocolProgressBar.classList.add('show');
                protocolProgressBar.style.boxShadow = '0 0 10px var(--success-green)';
                writeConsole("æ•°æ®åŒæ­¥å®Œæˆã€‚");

                setTimeout(() => {
                    protocolProgressBar.style.width = '0%';
                    protocolProgressBar.classList.remove('show');
                    protocolProgressBar.style.boxShadow = 'none';
                    protocolStatusMessage.textContent = '';
                    writeLog("Data synchronization complete. Cache updated.", 'success');
                }, 1500);

                syncDataBtn.textContent = 'æ•°æ®åŒæ­¥';
                syncDataBtn.disabled = false;
                syncDataBtn.style.boxShadow = '0 0 5px var(--neon-blue)';
            });

            const syncDataInterval = setInterval(() => {
                dataElements.networkLatency.textContent = `${(Math.random() * 5 + 0.5).toFixed(1)}ms`;
                dataElements.cpuLoad.textContent = `${(Math.random() * 10 + 20).toFixed(0)}%`;
            }, 100);

            setTimeout(() => {
                clearInterval(syncDataInterval);
                startDataSimulation(); // æ¢å¤æ­£å¸¸æ•°æ®æ¨¡æ‹Ÿ
            }, 2000);
        });

        // --- æ–°å¢ï¼š8. æ•°æ®ä¸Šä¼ é€»è¾‘ ---
        uploadDataBtn.addEventListener('click', () => {
            playSound(clickSound);
            if (uploadDataBtn.disabled) return;

            writeLog("Initiating data upload to secure server...", 'info');
            uploadDataBtn.disabled = true;
            uploadDataBtn.textContent = 'ä¸Šä¼ ä¸­...';
            uploadDataBtn.style.boxShadow = '0 0 10px var(--neon-pink)';

            protocolStatusMessage.textContent = 'æ­£åœ¨åŠ å¯†æ•°æ®åŒ…...';
            protocolStatusMessage.style.color = 'var(--neon-pink)';
            protocolProgressBar.style.width = '0%';
            protocolProgressBar.classList.remove('error');
            protocolProgressBar.classList.add('show');
            protocolProgressBar.style.boxShadow = '0 0 5px var(--neon-pink)';

            let uploadProgress = 0;
            const uploadInterval = setInterval(() => {
                uploadProgress += 5;
                protocolProgressBar.style.width = `${uploadProgress}%`;
                protocolProgressBar.style.boxShadow = `0 0 ${5 + (uploadProgress / 10)}px var(--neon-pink)`;

                if (uploadProgress < 30) {
                    protocolStatusMessage.textContent = 'æ­£åœ¨åŠ å¯†æ•°æ®åŒ…...';
                } else if (uploadProgress < 70) {
                    protocolStatusMessage.textContent = 'å»ºç«‹ä¸Šä¼ éš§é“...';
                } else if (uploadProgress < 100) {
                    protocolStatusMessage.textContent = 'ä¼ è¾“æ•°æ®å—...';
                } else {
                    clearInterval(uploadInterval);
                    protocolStatusMessage.textContent = 'æ•°æ®ä¸Šä¼ å®Œæˆã€‚';
                    protocolStatusMessage.style.color = 'var(--success-green)';
                    protocolProgressBar.style.width = '100%';
                    protocolProgressBar.style.boxShadow = '0 0 15px var(--success-green)';
                    writeConsole("æ•°æ®ä¸Šä¼ å®Œæˆã€‚æœåŠ¡å™¨ç¡®è®¤ã€‚");
                    writeLog("Data upload complete. Server acknowledged.", 'success');

                    setTimeout(() => {
                        protocolProgressBar.style.width = '0%';
                        protocolProgressBar.classList.remove('show');
                        protocolProgressBar.style.boxShadow = 'none';
                        protocolStatusMessage.textContent = '';
                    }, 1500);

                    uploadDataBtn.textContent = 'ä¸Šä¼ æ•°æ®';
                    uploadDataBtn.disabled = false;
                    uploadDataBtn.style.boxShadow = '0 0 5px var(--neon-blue)';
                }
            }, 150); // ä¸Šä¼ é€Ÿåº¦
        });

        // --- 9. é‡ç½®ç³»ç»Ÿé€»è¾‘ ---
        resetSystemBtn.addEventListener('click', () => {
            playSound(clickSound);
            if (isSystemResetting) return;

            isSystemResetting = true;
            writeLog("Initiating system reset...", 'warn');
            writeConsole("æ‰§è¡Œç³»ç»Ÿé‡ç½®...", 'command');

            // ç¦ç”¨æ‰€æœ‰æŒ‰é’®
            const allButtons = document.querySelectorAll('.control-button');
            allButtons.forEach(btn => btn.disabled = true);

            // åœæ­¢æ‰€æœ‰åŠ¨ç”»å’Œæ›´æ–°
            clearInterval(scrambleInterval);
            clearInterval(dataUpdateInterval);
            clearInterval(runtimeUpdateInterval);
            decodedTextElement.textContent = "ç³»ç»Ÿé‡ç½®ä¸­...";
            protocolStatusMessage.textContent = "ç³»ç»Ÿæ­£åœ¨é‡ç½®ã€‚è¯·ç­‰å¾…...";
            protocolStatusMessage.style.color = 'var(--warning-orange)';
            protocolProgressBar.style.width = '0%';
            protocolProgressBar.classList.add('show');
            protocolProgressBar.classList.remove('error'); // ç¡®ä¿ä¸æ˜¯çº¢è‰²
            protocolProgressBar.style.boxShadow = '0 0 10px var(--warning-orange)';

            systemRuntimeArea.style.display = 'none';
            stopDataSimulation(); // ç¡®ä¿æ•°æ®å›åˆ°åˆå§‹å€¼

            mainContainer.classList.remove('protocol-active', 'protocol-inactive-visual', 'emergency-shutdown-visual');
            mainContainer.style.animation = 'none'; // åœæ­¢æ‰€æœ‰è¾¹æ¡†åŠ¨ç”»ï¼Œç„¶åæ¢å¤é»˜è®¤

            let resetProgress = 0;
            const resetInterval = setInterval(() => {
                resetProgress += 20;
                protocolProgressBar.style.width = `${resetProgress}%`;
                if (resetProgress === 20) { writeLog("Clearing cached data...", 'info'); writeConsole("æ¸…é™¤ç¼“å­˜æ•°æ®..."); }
                if (resetProgress === 40) { writeLog("Reinitializing sub-systems...", 'info'); writeConsole("é‡æ–°åˆå§‹åŒ–å­ç³»ç»Ÿ..."); }
                if (resetProgress === 60) { writeLog("Verifying integrity...", 'info'); writeConsole("éªŒè¯ç³»ç»Ÿå®Œæ•´æ€§..."); }
                if (resetProgress === 80) { writeLog("Applying initial configuration...", 'info'); writeConsole("åº”ç”¨åˆå§‹é…ç½®..."); }

                if (resetProgress >= 100) {
                    clearInterval(resetInterval);
                    protocolProgressBar.style.width = '100%';
                    protocolProgressBar.style.boxShadow = '0 0 15px var(--success-green)';
                    protocolStatusMessage.textContent = 'ç³»ç»Ÿé‡ç½®å®Œæˆã€‚';
                    protocolStatusMessage.style.color = 'var(--success-green)';
                    writeLog("System reset complete. Ready for operation.", 'success');
                    writeConsole("ç³»ç»Ÿé‡ç½®å®Œæˆã€‚å‡†å¤‡å°±ç»ªã€‚", 'success');


                    setTimeout(() => {
                        protocolProgressBar.style.width = '0%';
                        protocolProgressBar.classList.remove('show');
                        protocolProgressBar.style.boxShadow = 'none';
                        protocolStatusMessage.textContent = '';
                        decodedTextElement.textContent = initialLogText; // æ¢å¤åˆå§‹æ—¥å¿—æ–‡æœ¬
                        startDecodingAnimation(); // é‡æ–°å¼€å§‹è§£ç åŠ¨ç”»
                    }, 1000);

                    // æ¢å¤åˆå§‹æŒ‰é’®çŠ¶æ€
                    isProtocolActive = false;
                    protocolStartTime = null;
                    startProtocolBtn.disabled = false;
                    startProtocolBtn.textContent = 'å¯åŠ¨åè®®';
                    startProtocolBtn.classList.remove('active');
                    stopProtocolBtn.disabled = true;
                    stopProtocolBtn.textContent = 'åœæ­¢åè®®';
                    stopProtocolBtn.classList.remove('active');
                    syncDataBtn.disabled = true;
                    uploadDataBtn.disabled = true; // é‡ç½®åä¸Šä¼ æ•°æ®æŒ‰é’®ç¦ç”¨
                    resetSystemBtn.disabled = false; // é‡ç½®æŒ‰é’®é‡æ–°å¯ç”¨
                    emergencyShutdownBtn.disabled = false; // ç´§æ€¥å…³é—­æŒ‰é’®é‡æ–°å¯ç”¨

                    mainContainer.style.animation = 'border-flicker 3s infinite alternate'; // æ¢å¤é»˜è®¤è¾¹æ¡†åŠ¨ç”»
                    startDataSimulation(); // æ¢å¤æ•°æ®æ¨¡æ‹Ÿ
                    isSystemResetting = false;
                }
            }, 400); // é‡ç½®é€Ÿåº¦
        });

        // --- 10. ç´§æ€¥å…³é—­é€»è¾‘ ---
        emergencyShutdownBtn.addEventListener('click', () => {
            playSound(alarmSound, 0.7); // æ’­æ”¾è­¦æŠ¥å£°
            if (emergencyShutdownBtn.disabled) return;

            writeLog("CRITICAL: Initiating emergency shutdown sequence!", 'error');
            writeConsole("::: ç´§æ€¥å…³é—­å‘½ä»¤å·²æ¥æ”¶ï¼ :::", 'error');
            screenOverlay.classList.add('glitch-noise'); // æ¿€æ´»å±å¹•å™ªå£°
            mainContainer.classList.add('emergency-shutdown-visual'); // ç´§æ€¥å…³é—­è¾¹æ¡†åŠ¨ç”»

            // ç¦ç”¨æ‰€æœ‰æŒ‰é’®
            const allButtons = document.querySelectorAll('.control-button');
            allButtons.forEach(btn => btn.disabled = true);

            clearInterval(scrambleInterval);
            clearInterval(dataUpdateInterval);
            clearInterval(runtimeUpdateInterval);
            decodedTextElement.textContent = "::: ç´§æ€¥å…³é—­è¿›è¡Œä¸­ :::";
            decodedTextElement.style.color = 'var(--error-red)';

            protocolStatusMessage.textContent = "::: è­¦å‘Šï¼šç³»ç»Ÿå®Œæ•´æ€§å—æŸã€‚æ­£åœ¨å¼ºåˆ¶æ–­å¼€è¿æ¥ï¼ :::";
            protocolStatusMessage.style.color = 'var(--error-red)';
            protocolProgressBar.style.width = '100%'; // ç«‹å³æ˜¾ç¤º100%
            protocolProgressBar.classList.add('show', 'error');
            protocolProgressBar.style.boxShadow = '0 0 20px var(--error-red)';

            systemRuntimeArea.style.display = 'none';
            stopDataSimulation();

            isProtocolActive = false;
            protocolStartTime = null;

            setTimeout(() => {
                writeLog("EMERGENCY SHUTDOWN COMPLETE. System offline.", 'error');
                writeConsole("--- ç³»ç»Ÿå·²å¼ºåˆ¶å…³é—­ ---", 'error');
                decodedTextElement.textContent = "--- ç³»ç»Ÿå·²å¼ºåˆ¶å…³é—­ ---";
                decodedTextElement.style.color = 'var(--light-text)'; // æ¢å¤é¢œè‰²
                protocolStatusMessage.textContent = 'ç³»ç»Ÿå·²ç¦»çº¿ã€‚';
                protocolStatusMessage.style.color = 'var(--light-text)';

                protocolProgressBar.style.width = '0%';
                protocolProgressBar.classList.remove('show', 'error');
                protocolProgressBar.style.boxShadow = 'none';

                mainContainer.classList.remove('protocol-active', 'protocol-inactive-visual', 'emergency-shutdown-visual');
                mainContainer.style.animation = 'border-flicker 3s infinite alternate'; // æ¢å¤é»˜è®¤è¾¹æ¡†åŠ¨ç”»

                screenOverlay.classList.remove('glitch-noise'); // ç§»é™¤å±å¹•å™ªå£°

                // æ¢å¤åˆå§‹æŒ‰é’®çŠ¶æ€
                startProtocolBtn.disabled = false;
                startProtocolBtn.textContent = 'å¯åŠ¨åè®®';

                stopProtocolBtn.disabled = true;
                stopProtocolBtn.textContent = 'åœæ­¢åè®®';
                stopProtocolBtn.classList.remove('active'); // ç¡®ä¿ç§»é™¤activeç±»
                syncDataBtn.disabled = true;
                uploadDataBtn.disabled = true; // ç´§æ€¥å…³é—­åä¸Šä¼ æ•°æ®æŒ‰é’®ç¦ç”¨
                resetSystemBtn.disabled = false;
                emergencyShutdownBtn.disabled = false;

                startDataSimulation(); // æ¢å¤æ•°æ®æ¨¡æ‹Ÿ
                startDecodingAnimation(); // æ¢å¤åˆå§‹è§£ç åŠ¨ç”»
            }, 3000); // ç´§æ€¥å…³é—­æŒç»­3ç§’
        });


        // --- 11. æ›´æ–°åè®®è¿è¡Œæ—¶é—´å’Œæ˜Ÿé™…æ ‡å‡†æ—¶ ---
        function updateProtocolRuntime() {
            if (protocolStartTime) {
                const elapsedMilliseconds = Date.now() - protocolStartTime;
                const totalSeconds = Math.floor(elapsedMilliseconds / 1000);
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;

                const formatTime = (num) => String(num).padStart(2, '0');
                protocolRuntimeDisplay.textContent = `${formatTime(hours)}:${formatTime(minutes)}:${formatTime(seconds)}`;
            }

            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth();
            const currentDay = now.getDate();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentSecond = now.getSeconds();

            const galacticYear = currentYear + 3456;
            const galacticMonth = (currentMonth + 5) % 12 + 1;
            const galacticDay = (currentDay + 10) % 30 + 1;

            const galacticEpoch = "GALACTIC-STANDARD";
            const galacticZone = "GH";

            galacticTimeDisplay.textContent =
                `${galacticEpoch} ${galacticYear}.${String(galacticMonth).padStart(2, '0')}.${String(galacticDay).padStart(2, '0')} ` +
                `${galacticZone}:${String(currentHour).padStart(2, '0')}.${String(currentMinute).padStart(2, '0')}.${String(currentSecond).padStart(2, '0')}`;
        }

        // --- 12. äº¤äº’å¼æ§åˆ¶å°é€»è¾‘ ---
        consoleInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault(); // é˜»æ­¢é»˜è®¤çš„æ¢è¡Œè¡Œä¸º
                const command = consoleInput.value.trim(); // ä½¿ç”¨trim()å¤„ç†å¤šè¡Œè¾“å…¥æ—¶çš„ç©ºç™½è¡Œ
                if (command === '') {
                    // å¦‚æœåªæœ‰ç©ºç™½è¡Œï¼Œæ¸…ç©ºå¹¶ä¿æŒä¸€è¡Œé«˜
                    consoleInput.value = '';
                    autoResizeConsoleInput();
                    return;
                }

                writeConsole(command, 'command');
                consoleHistory.unshift(command); // Add to history
                consoleHistoryIndex = -1; // Reset history index

                handleConsoleCommand(command.toLowerCase());
                consoleInput.value = ''; // æ¸…ç©ºè¾“å…¥æ¡†
                autoResizeConsoleInput(); // æ¸…ç©ºåé‡ç½®é«˜åº¦ä¸ºä¸€è¡Œ
            } else if (e.key === 'ArrowUp') {
                e.preventDefault(); // Prevent cursor from moving to start of input
                if (consoleHistory.length > 0) {
                    if (consoleHistoryIndex === -1) {
                        consoleHistoryIndex = 0;
                    } else if (consoleHistoryIndex < consoleHistory.length - 1) {
                        consoleHistoryIndex++;
                    }
                    consoleInput.value = consoleHistory[consoleHistoryIndex];
                    autoResizeConsoleInput(); // å†å²å‘½ä»¤åŠ è½½åè°ƒæ•´é«˜åº¦
                }
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (consoleHistory.length > 0) {
                    if (consoleHistoryIndex > 0) {
                        consoleHistoryIndex--;
                        consoleInput.value = consoleHistory[consoleHistoryIndex];
                        autoResizeConsoleInput(); // å†å²å‘½ä»¤åŠ è½½åè°ƒæ•´é«˜åº¦
                    } else {
                        consoleHistoryIndex = -1;
                        consoleInput.value = '';
                        autoResizeConsoleInput(); // æ¸…ç©ºåé‡ç½®é«˜åº¦ä¸ºä¸€è¡Œ
                    }
                }
            }
        });

        // æ–°å¢ï¼šç›‘å¬ input äº‹ä»¶ä»¥å®ç°å®æ—¶è‡ªé€‚åº”é«˜åº¦
        consoleInput.addEventListener('input', autoResizeConsoleInput);

        function handleConsoleCommand(command) {
            switch (command) {
                case 'help':
                    writeConsole("å¯ç”¨çš„å‘½ä»¤:");
                    writeConsole("  status   - æ˜¾ç¤ºå½“å‰ç³»ç»ŸçŠ¶æ€æ¦‚è§ˆ");
                    writeConsole("  log      - æ˜¾ç¤ºæœ€è¿‘çš„ç³»ç»Ÿæ—¥å¿—æ¡ç›®");
                    writeConsole("  protocol - æ˜¾ç¤ºåè®®çŠ¶æ€å’Œæ“ä½œæŒ‡ä»¤");
                    writeConsole("  clear    - æ¸…é™¤æ§åˆ¶å°è¾“å‡º");
                    writeConsole("  echo [message] - åœ¨æ§åˆ¶å°å›æ˜¾æ¶ˆæ¯");
                    writeConsole("  reboot   - æ¨¡æ‹Ÿç³»ç»Ÿé‡å¯ (ä¸'é‡ç½®ç³»ç»Ÿ'æŒ‰é’®ç›¸åŒ)");
                    writeConsole("  shutdown - æ¨¡æ‹Ÿç´§æ€¥å…³é—­ (ä¸'ç´§æ€¥å…³é—­'æŒ‰é’®ç›¸åŒ)");
                    break;
                case 'status':
                    writeConsole("--- ç³»ç»ŸçŠ¶æ€æ¦‚è§ˆ ---");
                    for (const key in dataElements) {
                        writeConsole(`  ${key.replace(/([A-Z])/g, ' $1').trim().replace(' ', ' ')}: ${dataElements[key].textContent}`);
                    }
                    break;
                case 'log':
                    writeConsole("--- æœ€è¿‘ç³»ç»Ÿæ—¥å¿— ---");
                    if (systemLogArea.children.length === 0) {
                        writeConsole("  æ—¥å¿—åŒºåŸŸä¸ºç©ºã€‚");
                    } else {
                        // åªæ˜¾ç¤ºæœ€åå‡ æ¡æ—¥å¿—
                        const logEntries = Array.from(systemLogArea.children);
                        const displayCount = Math.min(logEntries.length, 10);
                        for (let i = logEntries.length - displayCount; i < logEntries.length; i++) {
                            writeConsole(`  ${logEntries[i].textContent}`);
                        }
                    }
                    break;
                case 'protocol':
                    writeConsole("--- åè®®çŠ¶æ€ ---");
                    writeConsole(`  å½“å‰åè®®çŠ¶æ€: ${isProtocolActive ? 'æ¿€æ´»' : 'éæ¿€æ´»'}`);
                    writeConsole("  ä½¿ç”¨ 'start protocol' å¯åŠ¨åè®®ã€‚");
                    writeConsole("  ä½¿ç”¨ 'stop protocol' åœæ­¢åè®®ã€‚");
                    break;
                case 'clear':
                    consoleOutput.innerHTML = 'æ§åˆ¶å°å·²æ¸…é™¤ã€‚<br>';
                    break;
                case 'reboot':
                    writeConsole("æ‰§è¡Œé‡å¯å‘½ä»¤...", 'command');
                    resetSystemBtn.click(); // è§¦å‘é‡ç½®æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
                    break;
                case 'shutdown':
                    writeConsole("æ‰§è¡Œç´§æ€¥å…³é—­å‘½ä»¤...", 'command');
                    emergencyShutdownBtn.click(); // è§¦å‘ç´§æ€¥å…³é—­æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
                    break;
                case 'start protocol':
                    if (!isProtocolActive) {
                        writeConsole("æ­£åœ¨é€šè¿‡æ§åˆ¶å°å¯åŠ¨åè®®...", 'command');
                        startProtocolBtn.click();
                    } else {
                        writeConsole("åè®®å·²åœ¨è¿è¡Œä¸­ã€‚", 'error');
                    }
                    break;
                case 'stop protocol':
                    if (isProtocolActive) {
                        writeConsole("æ­£åœ¨é€šè¿‡æ§åˆ¶å°åœæ­¢åè®®...", 'command');
                        stopProtocolBtn.click();
                    } else {
                        writeConsole("åè®®æœªè¿è¡Œã€‚", 'error');
                    }
                    break;
                default:
                    if (command.startsWith('echo ')) {
                        writeConsole(command.substring(5)); // å›æ˜¾å‘½ä»¤åçš„å†…å®¹
                    } else {
                        writeConsole(`æœªçŸ¥å‘½ä»¤: '${command}'ã€‚è¾“å…¥ 'help' æŸ¥çœ‹å¯ç”¨å‘½ä»¤ã€‚`, 'error');
                    }
                    break;
            }
        }

        // --- 13. èƒŒæ™¯éŸ³ä¹æ§åˆ¶ ---
        musicToggleButton.addEventListener('click', () => {
            playSound(clickSound, 0.3); // æ’­æ”¾ä¸€ä¸ªè½»å¾®çš„ç‚¹å‡»éŸ³æ•ˆ
            if (backgroundMusic.paused) {
                backgroundMusic.play().catch(e => console.log("Music play failed:", e));
                musicToggleButton.classList.add('active');
                writeLog("Background music enabled.", 'info');
                musicToggleButton.querySelector('.icon').textContent = '||'; // æš‚åœå›¾æ ‡
            } else {
                backgroundMusic.pause();
                musicToggleButton.classList.remove('active');
                writeLog("Background music disabled.", 'info');
                musicToggleButton.querySelector('.icon').textContent = 'â™ª'; // æ’­æ”¾å›¾æ ‡
            }
        });

        // --- Linux å¼€æœºåŠ è½½åŠ¨ç”»åºåˆ— ---
        const loadingMessages = [
            "Initializing system...",
            "Scanning /dev/sda1 for file system errors... clean.",
            "Mounting /sys, /proc, /dev...",
            "Starting system logger...",
            "Activating network interfaces: eth0...",
            "Setting up hostname: alienware-tech",
            "Checking security protocols... OK.",
            "Loading kernel modules...",
            "Starting services: SSHD, NTP, Webserver...",
            "Starting AlienTech Protocol Service...",
            "Checking display drivers... OK.",
            "Applying quantum decryption algorithms...",
            "Synchronizing inter-dimensional relays...",
            "Boot sequence complete. Welcome to AlienTech Protocol System.",
            "", // æ·»åŠ ä¸€ä¸ªç©ºè¡Œï¼Œè®©å…‰æ ‡å‡ºç°åœ¨æœ€åä¸€è¡Œ
            "Ready."
        ];

        // è·å–åŠ è½½å±å¹•ç›¸å…³å…ƒç´ 
        const loadingScreen = document.getElementById('loading-screen');
        const loadingOutput = document.getElementById('loading-output');

        function startLoadingAnimation(callback) {
            let messageIndex = 0;
            let charIndex = 0;
            let outputLine = '';
            const typeSpeed = 30; // æ‰“å­—é€Ÿåº¦ (ms)
            const lineDelay = 500; // æ¯è¡Œä¹‹é—´çš„å»¶è¿Ÿ (ms)

            console.log("è¿›å…¥ startLoadingAnimation å‡½æ•°ã€‚"); // è°ƒè¯•æ—¥å¿—
            console.log("åˆå§‹ messageIndex:", messageIndex, "charIndex:", charIndex); // è°ƒè¯•æ—¥å¿—

            // æ£€æŸ¥ DOM å…ƒç´ æ˜¯å¦æˆåŠŸè·å–
            if (!loadingScreen || !loadingOutput) {
                console.error("é”™è¯¯: æ— æ³•æ‰¾åˆ° 'loading-screen' æˆ– 'loading-output' å…ƒç´ ã€‚è¯·æ£€æŸ¥HTML IDæ˜¯å¦æ­£ç¡®ã€‚");
                // å¦‚æœå…ƒç´ æœªæ‰¾åˆ°ï¼Œåˆ™ç›´æ¥è·³è¿‡åŠ¨ç”»ï¼Œæ˜¾ç¤ºä¸»å†…å®¹
                loadingScreen.classList.add('hidden');
                mainContainer.classList.add('loaded');
                document.body.style.overflow = 'auto';
                if (callback) callback();
                return;
            }

            function typeLine() {
                console.log(`--- typeLine æ‰§è¡Œ --- messageIndex: ${messageIndex}, charIndex: ${charIndex}`); // è°ƒè¯•æ—¥å¿—
                if (messageIndex < loadingMessages.length) {
                    const currentMessage = loadingMessages[messageIndex];
                    if (charIndex < currentMessage.length) {
                        outputLine += currentMessage[charIndex];
                        loadingOutput.textContent = outputLine;
                        charIndex++;
                        loadingOutput.scrollTop = loadingOutput.scrollHeight; // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
                        // console.log(`æ­£åœ¨æ‰“å°å­—ç¬¦: ${currentMessage[charIndex - 1]}ï¼Œå½“å‰ outputLine: "${outputLine.substring(0, Math.min(outputLine.length, 50))}..."`); // è¯¦ç»†è°ƒè¯•æ—¥å¿—
                        setTimeout(typeLine, typeSpeed); // <--- ç¡®ä¿è¿™ä¸€è¡Œè¢«è°ƒç”¨
                    } else {
                        // å½“å‰è¡Œæ‰“å­—å®Œæ¯•
                        outputLine += '\n'; // æ·»åŠ æ¢è¡Œ
                        loadingOutput.textContent = outputLine;
                        messageIndex++;
                        charIndex = 0;
                        console.log(`å½“å‰è¡Œæ‰“å°å®Œæ¯•ï¼Œåˆ‡æ¢åˆ°ä¸‹ä¸€è¡Œã€‚ä¸‹ä¸€è¡Œ messageIndex: ${messageIndex}`); // è°ƒè¯•æ—¥å¿—
                        setTimeout(typeLine, lineDelay); // <--- ç¡®ä¿è¿™ä¸€è¡Œè¢«è°ƒç”¨
                    }
                } else {
                    // æ‰€æœ‰æ¶ˆæ¯éƒ½å·²æ˜¾ç¤º
                    console.log("æ‰€æœ‰åŠ è½½æ¶ˆæ¯å·²æ˜¾ç¤ºå®Œæ¯•ã€‚"); // è°ƒè¯•æ—¥å¿—
                    setTimeout(() => {
                        loadingScreen.classList.add('hidden'); // éšè—åŠ è½½åŠ¨ç”»
                        mainContainer.classList.add('loaded'); // æ˜¾ç¤ºä¸»å†…å®¹
                        document.body.style.overflow = 'auto'; // æ¢å¤bodyçš„æ»šåŠ¨æ¡
                        if (callback) {
                            callback(); // è°ƒç”¨åŠ è½½å®Œæˆåçš„å›è°ƒå‡½æ•°
                        }
                    }, 1000); // éšè—åŠ¨ç”»å‰çš„é¢å¤–å»¶è¿Ÿ
                }
            }

            typeLine(); // å¼€å§‹æ‰“å­—åŠ¨ç”»
        }

        // --- é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ ---
        window.onload = () => {
            // å¯åŠ¨åŠ è½½åŠ¨ç”»ï¼Œå¹¶åœ¨å…¶å®Œæˆåæ‰§è¡ŒåŸæœ‰çš„é¡µé¢åŠ è½½é€»è¾‘
            startLoadingAnimation(() => {
                writeLog("System initialization sequence engaged.", 'info');
                startDecodingAnimation();
                resizeStarCanvas();
                animateStars();
                startDataSimulation();

                systemRuntimeArea.style.display = 'none';
                stopProtocolBtn.disabled = true;
                syncDataBtn.disabled = true;
                uploadDataBtn.disabled = true;
                resetSystemBtn.disabled = false;
                emergencyShutdownBtn.disabled = false;
                writeLog("System core loaded. Ready for command input.", 'success');
                consoleInput.focus();
                autoResizeConsoleInput();
            });
        };

        // --- çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°ç»˜åˆ¶æ˜Ÿç©º ---
        window.addEventListener('resize', resizeStarCanvas);
        /* JavaScript é€»è¾‘ç»“æŸ */
    </script>
</body>
</html>
